<body id="leftRightGrad" class="bg-white center">
  <div id="whiteGrad" class="container p-5 my-3 w-100 bg-white border-0">
    <!-- Heading for clients page -->
    <h1 class="display-2" style='padding-bottom:20px'><strong>Clients</strong><></h1>

    <!--Filter options-->
    <div class="row mb-3">
      <div class="col-md-6">
        <%= search_form_for @q, url: clients_path, method: :get, local: true, class: 'form-inline' do |f| %>
          <%= f.search_field :hashed_data_hashed_first_name_eq, class: 'form-control mr-sm-2 rounded-pill' ,
            placeholder: 'Filter by name' %>
            <%= f.search_field :address1_or_state_or_city_or_country_or_zip_cont,
              class: 'form-control mr-sm-2 rounded-pill' , placeholder: 'Filter by location' %>
              <%= f.submit "Search" , class: "btn rounded-pill btn-outline-info my-2 my-sm-0" %>
                <% end %>
                  <!-- Filter Button -->
                  <button type="button" id="filterButton" class="btn btn-secondary rounded-pill mr-sm-2">Filter
                    Options</button>
      </div>

      <!-- The filter modal -->
      <div class="modal" id="filterModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Filter Options</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Additional Filters Below</p>

              <%= search_form_for @q, url: clients_path, method: :get, local: true, class: 'form-inline' do |f| %>
                <!--Filter button for date-->
                <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_date">From Date:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.date_field :created_at_gteq, { class: 'form-control sort-select'} %>
                  </div>
                </div>
                <!--Filter button for age-->
                 <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_name">Age:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.select :sort_by_age, [['None', nil],
                                                ['Oldest to Youngest', 'age_in_years desc'], 
                                                ['Youngest to Oldest', 'age_in_years asc']], 
                              
                              {include_blank: true, 
                               selected: params[:q]&.dig(:sort_by_age)
                              }, 
                              
                              {class: 'form-control sort-select', 
                               id: 'sort-by-name-select', 
                               data: {button_id: 'filterButtonName' } 
                               } %>
                
                 <!-- <%= f.number_field :age_in_years_eq %> -->
                  </div>
                </div> 
                <!--Filter button for gender-->
                <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_client">Gender:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.select :gender_eq, [['None', nil], 
                                            ['Male', 'Male'], 
                                            ['Female', 'Female']
                                            ], 
                      {include_blank: true,
                       selected:params[:q]&.dig(:gender_eq) 
                       }, 
                       
                       { class: 'form-control sort-select', 
                       data: {button_id: 'filterButtonClient' } } %>
                  </div>
                </div>
                <!--Filter button for name-->
                <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_name">Name:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.select :hashed_data_source_attribute, [['None', nil], 
                                                 ['First Name (A-Z)', 'source_attribute asc' ], 
                                                 ['First Name(Z-A)', 'source_attribute' ], 
                                                 ['Last Name (A-Z)', 'hashed_value asc' ], 
                                                 ['Last Name(Z-A)', 'hashed_value desc' ]], 
                      {include_blank: true, 
                      selected: params[:q]&.dig(:hashed_data_source_attribute) 
                      }, 
                      
                      {
                      class: 'form-control sort-select' , 
                      id: 'sort-by-name-select' , 
                      data: {button_id: 'filterButtonName' } 
                      } %>
                  </div>
                </div>
                <!--Filter button for client-->
                <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_client">Client:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.select :sort_by_client, [['None', nil], 
                                                   ['Client Created (newest first)', 'created_at desc' ],
                                                   ['Client Created (oldest first)', 'created_at asc' ]], 
                      {include_blank: true, 
                      selected:params[:q]&.dig(:sort_by_client) 
                      }, 
                      
                      { class: 'form-control sort-select' , 
                      data: {button_id: 'filterButtonClient' } 
                      } %>
                  </div>
                </div>
                <!--Filter button for date of birth-->
                <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_date_birth">Date of Birth:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.select :sort_by_date_birth, [['None', nil], 
                                                       ['Date of Birth (newestfirst)', 'date_of_birth desc' ], 
                                                       ['Date of Birth (oldest first)', 'date_of_birth asc' ]],
                      {include_blank: true, 
                      selected: params[:q]&.dig(:sort_by_date_birth)
                      },
                    
                      { class: 'form-control sort-select' , 
                      data: {button_id: 'filterButtonDateofBirth' } 
                      } %>
                  </div>
                </div>
                <!--Filter button for country-->
                <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_client">Country:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.select :country_eq, [['None', nil], 
                                            ['Afghanistan', 'AF'],
                                            ['Albania', 'AL'],
                                            ['Algeria', 'DZ'],
                                            ['Andorra', 'AD'],
                                            ['Angola', 'AO'],
                                            ['Antigua and Barbuda', 'AG'],
                                            ['Argentina', 'AR'],
                                            ['Armenia', 'AM'],
                                            ['Australia', 'AU'],
                                            ['Austria', 'AT'],
                                            ['Azerbaijan', 'AZ'],
                                            ['Bahamas', 'BS'],
                                            ['Bahrain', 'BH'],
                                            ['Bangladesh', 'BD'],
                                            ['Barbados', 'BB'],
                                            ['Belarus', 'BY'],
                                            ['Belgium', 'BE'],
                                            ['Belize', 'BZ'],
                                            ['Benin', 'BJ'],
                                            ['Bhutan', 'BT'],
                                            ['Bolivia', 'BO'],
                                            ['Bosnia and Herzegovina', 'BA'],
                                            ['Botswana', 'BW'],
                                            ['Brazil', 'BR'],
                                            ['Brunei', 'BN'],
                                            ['Bulgaria', 'BG'],
                                            ['Burkina Faso', 'BF'],
                                            ['Burundi', 'BI'],
                                            ['Cabo Verde', 'CV'],
                                            ['Cambodia', 'KH'],
                                            ['Cameroon', 'CM'],
                                            ['Canada', 'CA'],
                                            ['Central African Republic', 'CF'],
                                            ['Chad', 'TD'],
                                            ['Chile', 'CL'],
                                            ['China', 'CN'],
                                            ['Colombia', 'CO'],
                                            ['Comoros', 'KM'],
                                            ['Congo (Congo-Brazzaville)', 'CG'],
                                            ['Costa Rica', 'CR'],
                                            ['Croatia', 'HR'],
                                            ['Cuba', 'CU'],
                                            ['Cyprus', 'CY'],
                                            ['Czechia (Czech Republic)', 'CZ'],
                                            ['Democratic Republic of the Congo', 'CD'],
                                            ['Denmark', 'DK'],
                                            ['Djibouti', 'DJ'],
                                            ['Dominica', 'DM'],
                                            ['Dominican Republic', 'DO'],
                                            ['Ecuador', 'EC'],
                                            ['Egypt', 'EG'],
                                            ['El Salvador', 'SV'],
                                            ['Equatorial Guinea', 'GQ'],
                                            ['Eritrea', 'ER'],
                                            ['Estonia', 'EE'],
                                            ['Eswatini (fmr. "Swaziland")', 'SZ'],
                                            ['Ethiopia', 'ET'],
                                            ['Fiji', 'FJ'],
                                            ['Finland', 'FI'],
                                            ['France', 'FR'],
                                            ['Gabon', 'GA'],
                                            ['Gambia', 'GM'],
                                            ['Georgia', 'GE'],
                                            ['Germany', 'DE'],
                                            ['Ghana', 'GH'],
                                            ['Greece', 'GR'],
                                            ['Grenada', 'GD'],
                                            ['Guatemala', 'GT'],
                                            ['Guinea', 'GN'],
                                            ['Guinea-Bissau', 'GW'],
                                            ['Guyana', 'GY'],
                                            ['Haiti', 'HT'],
                                            ['Holy See', 'VA'],
                                            ['Honduras', 'HN'],
                                            ['Hungary', 'HU'],
                                            ['Iceland', 'IS'],
                                            ['India', 'IN'],
                                            ['Indonesia', 'ID'],
                                            ['Iran', 'IR'],
                                            ['Iraq', 'IQ'],
                                            ['Ireland', 'IE'],
                                            ['Israel', 'IL'],
                                            ['Italy', 'IT'],
                                            ['Ivory Coast', 'CI'],
                                            ['Jamaica', 'JM'],
                                            ['Japan', 'JP'],
                                            ['Jordan', 'JO'],
                                            ['Kazakhstan', 'KZ'],
                                            ['Kenya', 'KE'],
                                            ['Kiribati', 'KI'],
                                            ['Kuwait', 'KW'],
                                            ['Kyrgyzstan', 'KG'],
                                            ['Laos', 'LA'],
                                            ['Latvia', 'LV'],
                                            ['Lebanon', 'LB'],
                                            ['Lesotho', 'LS'],
                                            ['Liberia', 'LR'],
                                            ['Libya', 'LY'],
                                            ['Liechtenstein', 'LI'],
                                            ['Lithuania', 'LT'],
                                            ['Luxembourg', 'LU'],
                                            ['Madagascar', 'MG'],
                                            ['Malawi', 'MW'],
                                            ['Malaysia', 'MY'],
                                            ['Maldives', 'MV'],
                                            ['Mali', 'ML'],
                                            ['Malta', 'MT'],
                                            ['Marshall Islands', 'MH'],
                                            ['Mauritania', 'MR'],
                                            ['Mauritius', 'MU'],
                                            ['Mexico', 'MX'],
                                            ['Micronesia', 'FM'],
                                            ['Moldova', 'MD'],
                                            ['Monaco', 'MC'],
                                            ['Mongolia', 'MN'],
                                            ['Montenegro', 'ME'],
                                            ['Morocco', 'MA'],
                                            ['Mozambique', 'MZ'],
                                            ['Myanmar (formerly Burma)', 'MM'],
                                            ['Namibia', 'NA'],
                                            ['Nauru', 'NR'],
                                            ['Nepal', 'NP'],
                                            ['Netherlands', 'NL'],
                                            ['New Zealand', 'NZ'],
                                            ['Nicaragua', 'NI'],
                                            ['Niger', 'NE'],
                                            ['Nigeria', 'NG'],
                                            ['North Korea', 'KP'],
                                            ['North Macedonia', 'MK'],
                                            ['Norway', 'NO'],
                                            ['Oman', 'OM'],
                                            ['Pakistan', 'PK'],
                                            ['Palau', 'PW'],
                                            ['Palestine State', 'PS'],
                                            ['Panama', 'PA'],
                                            ['Papua New Guinea', 'PG'],
                                            ['Paraguay', 'PY'],
                                            ['Peru', 'PE'],
                                            ['Philippines', 'PH'],
                                            ['Poland', 'PL'],
                                            ['Portugal', 'PT'],
                                            ['Qatar', 'QA'],
                                            ['Romania', 'RO'],
                                            ['Russia', 'RU'],
                                            ['Rwanda', 'RW'],
                                            ['Saint Kitts and Nevis', 'KN'],
                                            ['Saint Lucia', 'LC'],
                                            ['Saint Vincent and the Grenadines', 'VC'],
                                            ['Samoa', 'WS'],
                                            ['San Marino', 'SM'],
                                            ['Sao Tome and Principe', 'ST'],
                                            ['Saudi Arabia', 'SA'],
                                            ['Senegal', 'SN'],
                                            ['Serbia', 'RS'],
                                            ['Seychelles', 'SC'],
                                            ['Sierra Leone', 'SL'],
                                            ['Singapore', 'SG'],
                                            ['Slovakia', 'SK'],
                                            ['Slovenia', 'SI'],
                                            ['Solomon Islands', 'SB'],
                                            ['Somalia', 'SO'],
                                            ['South Africa', 'ZA'],
                                            ['South Korea', 'KR'],
                                            ['South Sudan', 'SS'],
                                            ['Spain', 'ES'],
                                            ['Sri Lanka', 'LK'],
                                            ['Sudan', 'SD'],
                                            ['Suriname', 'SR'],
                                            ['Sweden', 'SE'],
                                            ['Switzerland', 'CH'],
                                            ['Syria', 'SY'],
                                            ['Taiwan', 'TW'],
                                            ['Tajikistan', 'TJ'],
                                            ['Tanzania', 'TZ'],
                                            ['Thailand', 'TH'],
                                            ['Timor-Leste', 'TL'],
                                            ['Togo', 'TG'],
                                            ['Tonga', 'TO'],
                                            ['Trinidad and Tobago', 'TT'],
                                            ['Tunisia', 'TN'],
                                            ['Turkey', 'TR'],
                                            ['Turkmenistan', 'TM'],
                                            ['Tuvalu', 'TV'],
                                            ['Uganda', 'UG'],
                                            ['Ukraine', 'UA'],
                                            ['United Arab Emirates', 'AE'],
                                            ['United Kingdom', 'GB'],
                                            ['United States of America', 'US'],
                                            ['Uruguay', 'UY'],
                                            ['Uzbekistan', 'UZ'],
                                            ['Vanuatu', 'VU'],
                                            ['Venezuela', 'VE'],
                                            ['Vietnam', 'VN'],
                                            ['Yemen', 'YE'],
                                            ['Zambia', 'ZM'],
                                            ['Zimbabwe', 'ZW']], 
                      {include_blank: true, 
                      selected:params[:q]&.dig(:country_eq) 
                      }, 
                      
                      { class: 'form-control sort-select' , 
                      data: {button_id: 'filterButtonClient' } 
                      } %>
                  </div>
                </div>
                <!--Filter button for state-->
                <div class="row mb-2">
                  <div class="col-md-4">
                    <label for="from_client">State:</label>
                  </div>
                  <div class="col-md-8">
                    <%= f.select :state_eq, [['None', nil], 
                                            ['Alabama', 'AL'],
                                            ['Alaska', 'AK'],
                                            ['Arizona', 'AZ'],
                                            ['Arkansas', 'AR'],
                                            ['California', 'CA'],
                                            ['Colorado', 'CO'],
                                            ['Connecticut', 'CT'],
                                            ['Delaware', 'DE'],
                                            ['Florida', 'FL'],
                                            ['Georgia', 'GA'],
                                            ['Hawaii', 'HI'],
                                            ['Idaho', 'ID'],
                                            ['Illinois', 'IL'],
                                            ['Indiana', 'IN'],
                                            ['Iowa', 'IA'],
                                            ['Kansas', 'KS'],
                                            ['Kentucky', 'KY'],
                                            ['Louisiana', 'LA'],
                                            ['Maine', 'ME'],
                                            ['Maryland', 'MD'],
                                            ['Massachusetts', 'MA'],
                                            ['Michigan', 'MI'],
                                            ['Minnesota', 'MN'],
                                            ['Mississippi', 'MS'],
                                            ['Missouri', 'MO'],
                                            ['Montana', 'MT'],
                                            ['Nebraska', 'NE'],
                                            ['Nevada', 'NV'],
                                            ['New Hampshire', 'NH'],
                                            ['New Jersey', 'NJ'],
                                            ['New Mexico', 'NM'],
                                            ['New York', 'NY'],
                                            ['North Carolina', 'NC'],
                                            ['North Dakota', 'ND'],
                                            ['Ohio', 'OH'],
                                            ['Oklahoma', 'OK'],
                                            ['Oregon', 'OR'],
                                            ['Pennsylvania', 'PA'],
                                            ['Rhode Island', 'RI'],
                                            ['South Carolina', 'SC'],
                                            ['South Dakota', 'SD'],
                                            ['Tennessee', 'TN'],
                                            ['Texas', 'TX'],
                                            ['Utah', 'UT'],
                                            ['Vermont', 'VT'],
                                            ['Virginia', 'VA'],
                                            ['Washington', 'WA'],
                                            ['West Virginia', 'WV'],
                                            ['Wisconsin', 'WI'],
                                            ['Wyoming', 'WY']], 
                      {include_blank: true, 
                      selected:params[:q]&.dig(:state_eq) 
                      }, 
                      
                      { class: 'form-control sort-select' , 
                      data: {button_id: 'filterButtonClient' } 
                      } %>
                  </div>
                </div>
                <!--Filter option below is broken will need to fix later for age filtering, FIX ME-->
                <!--
                <div class="row mb-2">
              <div class="col-md-4">
                <label for="from_age">Age Range:</label>
              </div>
               <div class="col-md-8">
                <%= f.number_field :age_gteq,  class: 'form-control', placeholder: 'Min Age' %>
                <%= f.number_field :age_eq, class: 'form-control', placeholder: 'target Age' %>
                <%= f.number_field :age_lteq, class: 'form-control', placeholder: 'Max Age' %>
              </div>
            </div>
            -->
            </div>
            <div class="modal-footer">
              <button type="button" class="btn rounded-pill btn-outline-info my-2 my-sm-0" id="resetFiltersButton">Reset
                Filters</button>
              <%= f.submit "Apply Filter" , class: "btn rounded-pill btn-outline-info my-2 my-sm-0" %>
                <button type="button" class="btn rounded-pill btn-outline-info my-2 my-sm-0"
                  data-dismiss="modal">Close</button>
                <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- JS functionality for the modal-->
      <%= javascript_include_tag 'modalControlClientsIndex.js' %>

        <div class="col-md-6 text-right">
          <%= link_to 'Add New Client' , new_client_path, class: 'btn btn-primary rounded-pill btn-lg' %>
        </div>
    </div>
    <%= link_to 'Download CSV', clients_path(format: "csv"), class: 'btn btn-secondary mb-3' %>
   
    <!--Designs the table for the following columns from Client model where data will be displayed-->
    <div class="justify-content-center">
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>Edit</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>Gender</th>
              <th>Age</th>
              <th>Date of Birth</th>
              <th>Phone</th>
              <th>Address</th>
              <th>Country</th>
              <th>State</th>
              <th>City</th>
              <th>Tenant_ID</th>
              <th>Delete</th>
            </tr>
          </thead>
          
          <!--Take data from the Client model database and show it in the table-->
          <tbody>
            <% @clients.each do |client| %>
              <tr>
                <td>
                  <%= link_to edit_client_path(client) do %>
                    <%= image_tag 'edit_icon.png' , alt: 'Edit' ,width: 20 %>
                      <% end %>
                </td>
                <td>
                  <%= client.first_name %>
                </td>
                <td>
                  <%= client.last_name %>
                </td>
                <td>
                  <%= client.email %>
                </td>
                <td>
                  <%= client.gender %>
                </td>
                <td>
                  <%= client.age_in_years %>
                </td>
                <td>
                  <%= client.date_of_birth %>
                </td>
                <td>
                  <%= client.phone1 %>
                </td>
                <td>
                  <%= client.address1 %>
                </td>
                <td>
                  <%= client.country %>
                </td>
                <td>
                  <%= client.state %>
                </td>
                <td>
                  <%= client.city %>
                </td>
                <td>
                  <%= client.tenant_id %>
                </td>
                
                <td>
                  <%= link_to client_path(client), method: :delete, data: { confirm: 'Are you sure?' } do %>
                    <%= image_tag 'delete_icon.png' , alt: 'Delete' , width: 20 %>
                      <% end %>
                </td>
              </tr>
              <% end %>
          </tbody> 
        </table>
      </div>
    </div>
  </div>


  <div class="justify-content-center">
    <div class="table-responsive">
      <table>
        <thead>
        <tr>
          <th>Edit</th>
          <th>Record ID</th>
          <th>Model Came From</th>
          <th>First Name</th>
          <th>Last Name</th>
          <th>Email</th>
          <th>Gender</th>
          <th>Age</th>
          <th>Date of Birth</th>
          <th>Phone1</th>
          <th>Phone2</th>
          <th>Address</th>
          <th>Country</th>
          <th>State</th>
          <th>City</th>
          <th>Tenant_ID</th>
          <th>Delete</th>
        </tr>
        </thead>

        <!--Take data from the Client model database and show it in the table-->
        <tbody>
        <% @active_hashed_data.each do |client| %>
          <tr>
            <td>
              <%= link_to edit_client_path(client) do %>
                <%= image_tag 'edit_icon.png' , alt: 'Edit' ,width: 20 %>
              <% end %>
            </td>
            <td><%= client.record_id %></td>
            <td><%= client.source_model %></td>
            <td><%= client.hashed_first_name %></td>
            <td><%= client.hashed_last_name %></td>
            <td><%= client.hashed_email %></td>
            <td><%= client.hashed_gender %></td>
            <td><%= client.hashed_age %></td>
            <td><%= client.hashed_date_of_birth %></td>
            <td><%= client.hashed_phone1 %></td>
            <td><%= client.hashed_phone2 %></td>
            <td><%= client.hashed_address %></td>
            <td><%= client.hashed_country %></td>
            <td><%= client.hashed_state %></td>
            <td><%= client.hashed_city %></td>
            <td><%= client.hashed_tenant_id %></td>

            <td>
              <%= link_to client_path(client), method: :delete, data: { confirm: 'Are you sure?' } do %>
                <%= image_tag 'delete_icon.png' , alt: 'Delete' , width: 20 %>
              <% end %>
            </td>
          </tr>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
  </div>
</body>